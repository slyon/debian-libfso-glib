From 0737b26e4e209bc032ee8b03b1afff345ea1987a Mon Sep 17 00:00:00 2001
From: Heiko Stuebner <heiko@sntech.de>
Date: Wed, 6 Jan 2010 20:53:32 +0100
Subject: [PATCH] make vala-dbus-binding-tool really optional

---
 Makefile.in     |    2 -
 configure       |  127 ++++++-------------------------------------------------
 configure.ac    |    2 -
 src/Makefile.in |    2 -
 4 files changed, 14 insertions(+), 119 deletions(-)

diff --git a/Makefile.in b/Makefile.in
index 9be5a39..b98a0c6 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -201,8 +201,6 @@ SPECS_PATH = @SPECS_PATH@
 STRIP = @STRIP@
 VALAC = @VALAC@
 VALA_CFLAGS = @VALA_CFLAGS@
-VALA_DBUS_BINDING_TOOL_CFLAGS = @VALA_DBUS_BINDING_TOOL_CFLAGS@
-VALA_DBUS_BINDING_TOOL_LIBS = @VALA_DBUS_BINDING_TOOL_LIBS@
 VALA_LIBS = @VALA_LIBS@
 VERSION = @VERSION@
 abs_builddir = @abs_builddir@
diff --git a/configure b/configure
index 843692c..d45dde4 100755
--- a/configure
+++ b/configure
@@ -751,8 +751,6 @@ DBUS_LIBS
 DBUS_CFLAGS
 GLIB_LIBS
 GLIB_CFLAGS
-VALA_DBUS_BINDING_TOOL_LIBS
-VALA_DBUS_BINDING_TOOL_CFLAGS
 VALA_LIBS
 VALA_CFLAGS
 PKG_CONFIG
@@ -897,8 +895,6 @@ SPECS_PATH
 PKG_CONFIG
 VALA_CFLAGS
 VALA_LIBS
-VALA_DBUS_BINDING_TOOL_CFLAGS
-VALA_DBUS_BINDING_TOOL_LIBS
 GLIB_CFLAGS
 GLIB_LIBS
 DBUS_CFLAGS
@@ -1553,11 +1549,6 @@ Some influential environment variables:
   PKG_CONFIG  path to pkg-config utility
   VALA_CFLAGS C compiler flags for VALA, overriding pkg-config
   VALA_LIBS   linker flags for VALA, overriding pkg-config
-  VALA_DBUS_BINDING_TOOL_CFLAGS
-              C compiler flags for VALA_DBUS_BINDING_TOOL, overriding
-              pkg-config
-  VALA_DBUS_BINDING_TOOL_LIBS
-              linker flags for VALA_DBUS_BINDING_TOOL, overriding pkg-config
   GLIB_CFLAGS C compiler flags for GLIB, overriding pkg-config
   GLIB_LIBS   linker flags for GLIB, overriding pkg-config
   DBUS_CFLAGS C compiler flags for DBUS, overriding pkg-config
@@ -4588,13 +4579,13 @@ if test "${lt_cv_nm_interface+set}" = set; then :
 else
   lt_cv_nm_interface="BSD nm"
   echo "int some_variable = 0;" > conftest.$ac_ext
-  (eval echo "\"\$as_me:4591: $ac_compile\"" >&5)
+  (eval echo "\"\$as_me:4582: $ac_compile\"" >&5)
   (eval "$ac_compile" 2>conftest.err)
   cat conftest.err >&5
-  (eval echo "\"\$as_me:4594: $NM \\\"conftest.$ac_objext\\\"\"" >&5)
+  (eval echo "\"\$as_me:4585: $NM \\\"conftest.$ac_objext\\\"\"" >&5)
   (eval "$NM \"conftest.$ac_objext\"" 2>conftest.err > conftest.out)
   cat conftest.err >&5
-  (eval echo "\"\$as_me:4597: output\"" >&5)
+  (eval echo "\"\$as_me:4588: output\"" >&5)
   cat conftest.out >&5
   if $GREP 'External.*some_variable' conftest.out > /dev/null; then
     lt_cv_nm_interface="MS dumpbin"
@@ -5800,7 +5791,7 @@ ia64-*-hpux*)
   ;;
 *-*-irix6*)
   # Find out which ABI we are using.
-  echo '#line 5803 "configure"' > conftest.$ac_ext
+  echo '#line 5794 "configure"' > conftest.$ac_ext
   if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
@@ -7296,11 +7287,11 @@ else
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:7299: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:7290: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:7303: \$? = $ac_status" >&5
+   echo "$as_me:7294: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -7635,11 +7626,11 @@ else
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:7638: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:7629: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:7642: \$? = $ac_status" >&5
+   echo "$as_me:7633: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -7740,11 +7731,11 @@ else
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:7743: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:7734: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:7747: \$? = $ac_status" >&5
+   echo "$as_me:7738: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -7795,11 +7786,11 @@ else
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:7798: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:7789: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:7802: \$? = $ac_status" >&5
+   echo "$as_me:7793: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -10179,7 +10170,7 @@ else
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 10182 "configure"
+#line 10173 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -10275,7 +10266,7 @@ else
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 10278 "configure"
+#line 10269 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -10887,96 +10878,6 @@ $as_echo "yes" >&6; }
 	:
 fi
 
-pkg_failed=no
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for VALA_DBUS_BINDING_TOOL" >&5
-$as_echo_n "checking for VALA_DBUS_BINDING_TOOL... " >&6; }
-
-if test -n "$PKG_CONFIG"; then
-    if test -n "$VALA_DBUS_BINDING_TOOL_CFLAGS"; then
-        pkg_cv_VALA_DBUS_BINDING_TOOL_CFLAGS="$VALA_DBUS_BINDING_TOOL_CFLAGS"
-    else
-        if test -n "$PKG_CONFIG" && \
-    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"vala-dbus-binding-tool-1.0 >= \$VDBT_REQUIRED\""; } >&5
-  ($PKG_CONFIG --exists --print-errors "vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }; then
-  pkg_cv_VALA_DBUS_BINDING_TOOL_CFLAGS=`$PKG_CONFIG --cflags "vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED" 2>/dev/null`
-else
-  pkg_failed=yes
-fi
-    fi
-else
-	pkg_failed=untried
-fi
-if test -n "$PKG_CONFIG"; then
-    if test -n "$VALA_DBUS_BINDING_TOOL_LIBS"; then
-        pkg_cv_VALA_DBUS_BINDING_TOOL_LIBS="$VALA_DBUS_BINDING_TOOL_LIBS"
-    else
-        if test -n "$PKG_CONFIG" && \
-    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"vala-dbus-binding-tool-1.0 >= \$VDBT_REQUIRED\""; } >&5
-  ($PKG_CONFIG --exists --print-errors "vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }; then
-  pkg_cv_VALA_DBUS_BINDING_TOOL_LIBS=`$PKG_CONFIG --libs "vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED" 2>/dev/null`
-else
-  pkg_failed=yes
-fi
-    fi
-else
-	pkg_failed=untried
-fi
-
-
-
-if test $pkg_failed = yes; then
-
-if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
-        _pkg_short_errors_supported=yes
-else
-        _pkg_short_errors_supported=no
-fi
-        if test $_pkg_short_errors_supported = yes; then
-	        VALA_DBUS_BINDING_TOOL_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED"`
-        else
-	        VALA_DBUS_BINDING_TOOL_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED"`
-        fi
-	# Put the nasty error message in config.log where it belongs
-	echo "$VALA_DBUS_BINDING_TOOL_PKG_ERRORS" >&5
-
-	as_fn_error "Package requirements (vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED) were not met:
-
-$VALA_DBUS_BINDING_TOOL_PKG_ERRORS
-
-Consider adjusting the PKG_CONFIG_PATH environment variable if you
-installed software in a non-standard prefix.
-
-Alternatively, you may set the environment variables VALA_DBUS_BINDING_TOOL_CFLAGS
-and VALA_DBUS_BINDING_TOOL_LIBS to avoid the need to call pkg-config.
-See the pkg-config man page for more details.
-" "$LINENO" 5
-elif test $pkg_failed = untried; then
-	{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "The pkg-config script could not be found or is too old.  Make sure it
-is in your PATH or set the PKG_CONFIG environment variable to the full
-path to pkg-config.
-
-Alternatively, you may set the environment variables VALA_DBUS_BINDING_TOOL_CFLAGS
-and VALA_DBUS_BINDING_TOOL_LIBS to avoid the need to call pkg-config.
-See the pkg-config man page for more details.
-
-To get pkg-config, see <http://pkg-config.freedesktop.org/>.
-See \`config.log' for more details." "$LINENO" 5; }
-else
-	VALA_DBUS_BINDING_TOOL_CFLAGS=$pkg_cv_VALA_DBUS_BINDING_TOOL_CFLAGS
-	VALA_DBUS_BINDING_TOOL_LIBS=$pkg_cv_VALA_DBUS_BINDING_TOOL_LIBS
-        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-	:
-fi
-
 
 pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GLIB" >&5
diff --git a/configure.ac b/configure.ac
index c075047..4a10aff 100644
--- a/configure.ac
+++ b/configure.ac
@@ -48,8 +48,6 @@ DBUS_REQUIRED=0.70
 
 PKG_CHECK_MODULES(VALA,
 	vala-1.0 >= $VALA_REQUIRED)
-PKG_CHECK_MODULES(VALA_DBUS_BINDING_TOOL,
-	vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED)
 
 PKG_CHECK_MODULES(GLIB,
 	glib-2.0 >= $GLIB_REQUIRED
diff --git a/src/Makefile.in b/src/Makefile.in
index 028c3d1..0d8d8af 100644
--- a/src/Makefile.in
+++ b/src/Makefile.in
@@ -186,8 +186,6 @@ SPECS_PATH = @SPECS_PATH@
 STRIP = @STRIP@
 VALAC = @VALAC@
 VALA_CFLAGS = @VALA_CFLAGS@
-VALA_DBUS_BINDING_TOOL_CFLAGS = @VALA_DBUS_BINDING_TOOL_CFLAGS@
-VALA_DBUS_BINDING_TOOL_LIBS = @VALA_DBUS_BINDING_TOOL_LIBS@
 VALA_LIBS = @VALA_LIBS@
 VERSION = @VERSION@
 abs_builddir = @abs_builddir@
-- 
1.6.5

