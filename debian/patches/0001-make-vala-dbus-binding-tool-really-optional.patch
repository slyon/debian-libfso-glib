From 451b52d1f05cb65d028bc95fae3bab35661844a9 Mon Sep 17 00:00:00 2001
From: Heiko Stuebner <heiko@sntech.de>
Date: Sun, 15 Nov 2009 17:50:40 +0100
Subject: [PATCH] make vala-dbus-binding-tool really optional

---
 Makefile.in     |    2 -
 configure       |  150 +++++-------------------------------------------------
 configure.ac    |    2 -
 src/Makefile.in |    2 -
 4 files changed, 14 insertions(+), 142 deletions(-)

diff --git a/Makefile.in b/Makefile.in
index e0681bc..a4229ca 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -148,8 +148,6 @@ SPECS_PATH = @SPECS_PATH@
 STRIP = @STRIP@
 VALAC = @VALAC@
 VALA_CFLAGS = @VALA_CFLAGS@
-VALA_DBUS_BINDING_TOOL_CFLAGS = @VALA_DBUS_BINDING_TOOL_CFLAGS@
-VALA_DBUS_BINDING_TOOL_LIBS = @VALA_DBUS_BINDING_TOOL_LIBS@
 VALA_LIBS = @VALA_LIBS@
 VERSION = @VERSION@
 abs_builddir = @abs_builddir@
diff --git a/configure b/configure
index 2805bed..7dc68e5 100755
--- a/configure
+++ b/configure
@@ -792,8 +792,6 @@ DBUS_LIBS
 DBUS_CFLAGS
 GLIB_LIBS
 GLIB_CFLAGS
-VALA_DBUS_BINDING_TOOL_LIBS
-VALA_DBUS_BINDING_TOOL_CFLAGS
 VALA_LIBS
 VALA_CFLAGS
 PKG_CONFIG
@@ -934,8 +932,6 @@ SPECS_PATH
 PKG_CONFIG
 VALA_CFLAGS
 VALA_LIBS
-VALA_DBUS_BINDING_TOOL_CFLAGS
-VALA_DBUS_BINDING_TOOL_LIBS
 GLIB_CFLAGS
 GLIB_LIBS
 DBUS_CFLAGS
@@ -1599,11 +1595,6 @@ Some influential environment variables:
   PKG_CONFIG  path to pkg-config utility
   VALA_CFLAGS C compiler flags for VALA, overriding pkg-config
   VALA_LIBS   linker flags for VALA, overriding pkg-config
-  VALA_DBUS_BINDING_TOOL_CFLAGS
-              C compiler flags for VALA_DBUS_BINDING_TOOL, overriding
-              pkg-config
-  VALA_DBUS_BINDING_TOOL_LIBS
-              linker flags for VALA_DBUS_BINDING_TOOL, overriding pkg-config
   GLIB_CFLAGS C compiler flags for GLIB, overriding pkg-config
   GLIB_LIBS   linker flags for GLIB, overriding pkg-config
   DBUS_CFLAGS C compiler flags for DBUS, overriding pkg-config
@@ -4520,13 +4511,13 @@ if test "${lt_cv_nm_interface+set}" = set; then
 else
   lt_cv_nm_interface="BSD nm"
   echo "int some_variable = 0;" > conftest.$ac_ext
-  (eval echo "\"\$as_me:4523: $ac_compile\"" >&5)
+  (eval echo "\"\$as_me:4514: $ac_compile\"" >&5)
   (eval "$ac_compile" 2>conftest.err)
   cat conftest.err >&5
-  (eval echo "\"\$as_me:4526: $NM \\\"conftest.$ac_objext\\\"\"" >&5)
+  (eval echo "\"\$as_me:4517: $NM \\\"conftest.$ac_objext\\\"\"" >&5)
   (eval "$NM \"conftest.$ac_objext\"" 2>conftest.err > conftest.out)
   cat conftest.err >&5
-  (eval echo "\"\$as_me:4529: output\"" >&5)
+  (eval echo "\"\$as_me:4520: output\"" >&5)
   cat conftest.out >&5
   if $GREP 'External.*some_variable' conftest.out > /dev/null; then
     lt_cv_nm_interface="MS dumpbin"
@@ -5732,7 +5723,7 @@ ia64-*-hpux*)
   ;;
 *-*-irix6*)
   # Find out which ABI we are using.
-  echo '#line 5735 "configure"' > conftest.$ac_ext
+  echo '#line 5726 "configure"' > conftest.$ac_ext
   if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
@@ -7555,11 +7546,11 @@ else
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:7558: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:7549: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:7562: \$? = $ac_status" >&5
+   echo "$as_me:7553: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -7894,11 +7885,11 @@ else
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:7897: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:7888: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:7901: \$? = $ac_status" >&5
+   echo "$as_me:7892: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -7999,11 +7990,11 @@ else
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:8002: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:7993: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:8006: \$? = $ac_status" >&5
+   echo "$as_me:7997: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -8054,11 +8045,11 @@ else
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:8057: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:8048: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:8061: \$? = $ac_status" >&5
+   echo "$as_me:8052: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -10870,7 +10861,7 @@ else
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 10873 "configure"
+#line 10864 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -10966,7 +10957,7 @@ else
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 10969 "configure"
+#line 10960 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -11609,119 +11600,6 @@ $as_echo "yes" >&6; }
 	:
 fi
 
-pkg_failed=no
-{ $as_echo "$as_me:$LINENO: checking for VALA_DBUS_BINDING_TOOL" >&5
-$as_echo_n "checking for VALA_DBUS_BINDING_TOOL... " >&6; }
-
-if test -n "$PKG_CONFIG"; then
-    if test -n "$VALA_DBUS_BINDING_TOOL_CFLAGS"; then
-        pkg_cv_VALA_DBUS_BINDING_TOOL_CFLAGS="$VALA_DBUS_BINDING_TOOL_CFLAGS"
-    else
-        if test -n "$PKG_CONFIG" && \
-    { ($as_echo "$as_me:$LINENO: \$PKG_CONFIG --exists --print-errors \"vala-dbus-binding-tool-1.0 >= \$VDBT_REQUIRED\"") >&5
-  ($PKG_CONFIG --exists --print-errors "vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
-  pkg_cv_VALA_DBUS_BINDING_TOOL_CFLAGS=`$PKG_CONFIG --cflags "vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED" 2>/dev/null`
-else
-  pkg_failed=yes
-fi
-    fi
-else
-	pkg_failed=untried
-fi
-if test -n "$PKG_CONFIG"; then
-    if test -n "$VALA_DBUS_BINDING_TOOL_LIBS"; then
-        pkg_cv_VALA_DBUS_BINDING_TOOL_LIBS="$VALA_DBUS_BINDING_TOOL_LIBS"
-    else
-        if test -n "$PKG_CONFIG" && \
-    { ($as_echo "$as_me:$LINENO: \$PKG_CONFIG --exists --print-errors \"vala-dbus-binding-tool-1.0 >= \$VDBT_REQUIRED\"") >&5
-  ($PKG_CONFIG --exists --print-errors "vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
-  pkg_cv_VALA_DBUS_BINDING_TOOL_LIBS=`$PKG_CONFIG --libs "vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED" 2>/dev/null`
-else
-  pkg_failed=yes
-fi
-    fi
-else
-	pkg_failed=untried
-fi
-
-
-
-if test $pkg_failed = yes; then
-
-if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
-        _pkg_short_errors_supported=yes
-else
-        _pkg_short_errors_supported=no
-fi
-        if test $_pkg_short_errors_supported = yes; then
-	        VALA_DBUS_BINDING_TOOL_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED"`
-        else
-	        VALA_DBUS_BINDING_TOOL_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED"`
-        fi
-	# Put the nasty error message in config.log where it belongs
-	echo "$VALA_DBUS_BINDING_TOOL_PKG_ERRORS" >&5
-
-	{ { $as_echo "$as_me:$LINENO: error: Package requirements (vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED) were not met:
-
-$VALA_DBUS_BINDING_TOOL_PKG_ERRORS
-
-Consider adjusting the PKG_CONFIG_PATH environment variable if you
-installed software in a non-standard prefix.
-
-Alternatively, you may set the environment variables VALA_DBUS_BINDING_TOOL_CFLAGS
-and VALA_DBUS_BINDING_TOOL_LIBS to avoid the need to call pkg-config.
-See the pkg-config man page for more details.
-" >&5
-$as_echo "$as_me: error: Package requirements (vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED) were not met:
-
-$VALA_DBUS_BINDING_TOOL_PKG_ERRORS
-
-Consider adjusting the PKG_CONFIG_PATH environment variable if you
-installed software in a non-standard prefix.
-
-Alternatively, you may set the environment variables VALA_DBUS_BINDING_TOOL_CFLAGS
-and VALA_DBUS_BINDING_TOOL_LIBS to avoid the need to call pkg-config.
-See the pkg-config man page for more details.
-" >&2;}
-   { (exit 1); exit 1; }; }
-elif test $pkg_failed = untried; then
-	{ { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: The pkg-config script could not be found or is too old.  Make sure it
-is in your PATH or set the PKG_CONFIG environment variable to the full
-path to pkg-config.
-
-Alternatively, you may set the environment variables VALA_DBUS_BINDING_TOOL_CFLAGS
-and VALA_DBUS_BINDING_TOOL_LIBS to avoid the need to call pkg-config.
-See the pkg-config man page for more details.
-
-To get pkg-config, see <http://pkg-config.freedesktop.org/>.
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: The pkg-config script could not be found or is too old.  Make sure it
-is in your PATH or set the PKG_CONFIG environment variable to the full
-path to pkg-config.
-
-Alternatively, you may set the environment variables VALA_DBUS_BINDING_TOOL_CFLAGS
-and VALA_DBUS_BINDING_TOOL_LIBS to avoid the need to call pkg-config.
-See the pkg-config man page for more details.
-
-To get pkg-config, see <http://pkg-config.freedesktop.org/>.
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-else
-	VALA_DBUS_BINDING_TOOL_CFLAGS=$pkg_cv_VALA_DBUS_BINDING_TOOL_CFLAGS
-	VALA_DBUS_BINDING_TOOL_LIBS=$pkg_cv_VALA_DBUS_BINDING_TOOL_LIBS
-        { $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
-	:
-fi
-
 
 pkg_failed=no
 { $as_echo "$as_me:$LINENO: checking for GLIB" >&5
diff --git a/configure.ac b/configure.ac
index c075047..4a10aff 100644
--- a/configure.ac
+++ b/configure.ac
@@ -48,8 +48,6 @@ DBUS_REQUIRED=0.70
 
 PKG_CHECK_MODULES(VALA,
 	vala-1.0 >= $VALA_REQUIRED)
-PKG_CHECK_MODULES(VALA_DBUS_BINDING_TOOL,
-	vala-dbus-binding-tool-1.0 >= $VDBT_REQUIRED)
 
 PKG_CHECK_MODULES(GLIB,
 	glib-2.0 >= $GLIB_REQUIRED
diff --git a/src/Makefile.in b/src/Makefile.in
index 2d2a447..c77cebc 100644
--- a/src/Makefile.in
+++ b/src/Makefile.in
@@ -153,8 +153,6 @@ SPECS_PATH = @SPECS_PATH@
 STRIP = @STRIP@
 VALAC = @VALAC@
 VALA_CFLAGS = @VALA_CFLAGS@
-VALA_DBUS_BINDING_TOOL_CFLAGS = @VALA_DBUS_BINDING_TOOL_CFLAGS@
-VALA_DBUS_BINDING_TOOL_LIBS = @VALA_DBUS_BINDING_TOOL_LIBS@
 VALA_LIBS = @VALA_LIBS@
 VERSION = @VERSION@
 abs_builddir = @abs_builddir@
-- 
1.6.3.3

